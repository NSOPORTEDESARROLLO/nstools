#!/bin/bash


NSTOOLS_PATH="/opt/nstools"

	. /opt/nstools/lib/header
	. /opt/nstools/lib/nsid_actions

trap "exec $NSTOOLS_PATH/bin/gui_nsid_tools" SIGINT

#Vamos a probar si el contenedor esta instalado y corriendo 
#Probando si esta corriendo:
test_run=$(docker ps |grep "cloudnode" |wc -l)
nsid=$(ifconfig tap-nsid |grep "inet " |awk '{print $2}')


if [ "$test_run" = "0" ];then

	echo "El servicio de NSID no se encuentra instalado, desea activarlo?

	      [1]  -  Si
	      [r]  -  Regresar

	"

	read INSTALL


	#Opcion de redireccion
	if [ "$INSTALL" = "r" ];then
		exec $NSTOOLS_PATH/bin/cat_system

	elif [ "$INSTALL" = "1" ]; then
		

		echo "Digite el usuario suministrado por Nsoporte:"

		while [ "$USERNAME" = "" ];do

			read USERNAME
		done


		echo "Digite la contraseña suministrada por Nsoporte:"

		while [ "$PASSWORD" = "" ];do

			read PASSWORD
		done


		echo "Digite el servidor: [cloudnode1.nsoporte.com]"

		read SERVER

		if [ "$SERVER" = "" ];then

			SERVER="cloudnode1.nsoporte.com"
		fi

		InstallNSID $USERNAME $PASSWORD $SERVER



	exec $NSTOOLS_PATH/bin/cat_system	


	fi

fi





echo "Seleccione una opcion para el nsid: $nsid 

	[1]  -  Cambiar NSID
	[2]  -  Borrar NSID 
		
	[r]  -  Regresar


"

read OPT


#Opcion de redireccion
if [ "$OPT" = "r" ];then
	exec $NSTOOLS_PATH/bin/cat_system

elif [ "$OPT" = "2" ];then
	DelNSID cloudnode
	exec $NSTOOLS_PATH/bin/gui_nsid_tools

elif [ "$OPT" = "1" ];then

		echo "Digite el usuario suministrado por Nsoporte:"

		while [ "$USERNAME" = "" ];do

			read USERNAME
		done


		echo "Digite la contraseña suministrada por Nsoporte:"

		while [ "$PASSWORD" = "" ];do

			read PASSWORD
		done


		echo "Digite el servidor: [cloudnode1.nsoporte.com]"

		read SERVER

		if [ "$SERVER" = "" ];then

			SERVER="cloudnode1.nsoporte.com"
		fi

		
		echo "¿Seguro desea cambiar el NSID?"

		echo "         [1]  -  No"
        echo "         [2]  -  Si"

        read YESNO


        if [ "$YESNO" = "2" ];then

        	DelNSID cloudnode
        	InstallNSID $USERNAME $PASSWORD $SERVER

	    fi 

	    exec $NSTOOLS_PATH/bin/gui_nsid_tools   



fi



